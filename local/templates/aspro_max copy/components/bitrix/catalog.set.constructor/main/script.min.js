BX.namespace("BX.Catalog.SetConstructor"),BX.Catalog.SetConstructor=function(){var t=function(t){this.numSliderItems=t.numSliderItems||0,this.numSetItems=t.numSetItems||0,this.jsId=t.jsId||"",this.ajaxPath=t.ajaxPath||"",this.currency=t.currency||"",this.lid=t.lid||"",this.iblockId=t.iblockId||"",this.basketUrl=t.basketUrl||"",this.setIds=t.setIds||null,this.offersCartProps=t.offersCartProps||null,this.itemsRatio=t.itemsRatio||null,this.noFotoSrc=t.noFotoSrc||"",this.messages=t.messages,this.canBuy=t.canBuy,this.mainElementPrice=t.mainElementPrice||0,this.mainElementOldPrice=t.mainElementOldPrice||0,this.mainElementDiffPrice=t.mainElementDiffPrice||0,this.mainElementBasketQuantity=t.mainElementBasketQuantity||1,this.parentCont=BX(t.parentContId)||null,this.sliderParentCont=this.parentCont.querySelector("[data-role='slider-parent-container']"),this.sliderItemsCont=this.parentCont.querySelector("[data-role='set-other-items']"),this.setItemsCont=this.parentCont.querySelector("[data-role='set-items']"),this.setPriceCont=this.parentCont.querySelector("[data-role='set-price']"),this.setPriceDuplicateCont=this.parentCont.querySelector("[data-role='set-price-duplicate']"),this.setOldPriceCont=this.parentCont.querySelector("[data-role='set-old-price']"),this.setOldPriceRow=this.setOldPriceCont.parentNode.parentNode,this.setDiffPriceCont=this.parentCont.querySelector("[data-role='set-diff-price']"),this.setDiffPriceRow=this.setDiffPriceCont.parentNode.parentNode,this.notAvailProduct=this.sliderItemsCont.querySelector("[data-not-avail='yes']"),this.emptySetMessage=this.parentCont.querySelector("[data-set-message='empty-set']"),BX.bindDelegate(this.setItemsCont,"click",{attribute:"data-role"},BX.proxy(this.deleteFromSet,this)),BX.bindDelegate(this.sliderItemsCont,"click",{attribute:"data-role"},BX.proxy(this.addToSet,this));var e=this.parentCont.querySelector("[data-role='set-buy-btn']");this.canBuy?(BX.show(e),BX.bind(e,"click",BX.proxy(this.addToBasket,this))):BX.hide(e),this.generateSliderStyles()};return t.prototype.generateSliderStyles=function(){var t=BX.create("style",{html:".bx-catalog-set-topsale-slids-"+this.jsId+"{width: "+25*this.numSliderItems+"%;}.bx-catalog-set-item-container-"+this.jsId+"{width: "+100/this.numSliderItems+"%;}@media (max-width:767px){.bx-catalog-set-topsale-slids-"+this.jsId+"{width: "+20*this.numSliderItems*2+"%;}}",attrs:{id:"bx-set-const-style-"+this.jsId}});BX("bx-set-const-style-"+this.jsId)&&BX.remove(BX("bx-set-const-style-"+this.jsId)),this.parentCont.appendChild(t)},t.prototype.deleteFromSet=function(){var t,e,a,i,s,r,n,d,l,o,c,m,h,u,p,b=BX.proxy_context;if(b&&b.hasAttribute("data-role")&&"set-delete-btn"==b.getAttribute("data-role")){for(e=(t=b.parentNode.parentNode).getAttribute("data-id"),a=t.getAttribute("data-name"),i=t.getAttribute("data-url"),s=t.getAttribute("data-img"),r=t.getAttribute("data-print-price"),n=t.getAttribute("data-price"),d=t.getAttribute("data-print-old-price"),l=t.getAttribute("data-old-price"),o=t.getAttribute("data-diff-price"),c=t.getAttribute("data-measure"),m=t.getAttribute("data-quantity"),p=BX.create("div",{attrs:{className:"bx-catalog-set-item-container bx-catalog-set-item-container-"+this.jsId,"data-id":e,"data-img":s||"","data-url":i,"data-name":a,"data-print-price":r,"data-print-old-price":d,"data-price":n,"data-old-price":l,"data-diff-price":o,"data-measure":c,"data-quantity":m},children:[BX.create("div",{attrs:{className:"bx-catalog-set-item"},children:[BX.create("div",{attrs:{className:"bx-catalog-set-item-img"},children:[BX.create("div",{attrs:{className:"bx-catalog-set-item-img-container"},children:[BX.create("img",{attrs:{src:s||this.noFotoSrc,className:"img-responsive"}})]})]}),BX.create("div",{attrs:{className:"bx-catalog-set-item-title"},children:[BX.create("a",{attrs:{href:i,className:"dark_link font_sm"},html:a})]}),BX.create("div",{attrs:{className:"bx-catalog-set-item-price"},children:[BX.create("div",{attrs:{className:"bx-catalog-set-item-price-new font_sm"},html:r+" * "+m+c}),BX.create("div",{attrs:{className:"bx-catalog-set-item-price-old  muted font_sxs"},html:n!=l?d:""})]}),BX.create("div",{attrs:{className:"bx-catalog-set-item-add-btn"},children:[BX.create("a",{attrs:{className:"btn btn-default btn-xs","data-role":"set-add-btn"},html:this.messages.ADD_BUTTON})]})]})]}),this.notAvailProduct?this.sliderItemsCont.insertBefore(p,this.notAvailProduct):this.sliderItemsCont.appendChild(p),this.numSliderItems++,this.numSetItems--,this.generateSliderStyles(),BX.remove(t),h=0,u=this.setIds.length;h<u;h++)this.setIds[h]==e&&this.setIds.splice(h,1);this.recountPrice(),this.numSetItems<=0&&this.emptySetMessage&&BX.adjust(this.emptySetMessage,{style:{display:"inline-block"},html:this.messages.EMPTY_SET}),0<this.numSliderItems&&this.sliderParentCont&&(this.sliderParentCont.style.display="")}},t.prototype.addToSet=function(){var t,e,a,i,s,r,n,d,l,o,c,m,h,u=BX.proxy_context;u&&u.hasAttribute("data-role")&&"set-add-btn"==u.getAttribute("data-role")&&(e=(t=u.parentNode.parentNode.parentNode).getAttribute("data-id"),a=t.getAttribute("data-name"),i=t.getAttribute("data-url"),s=t.getAttribute("data-img"),r=t.getAttribute("data-print-price"),n=t.getAttribute("data-price"),d=t.getAttribute("data-print-old-price"),l=t.getAttribute("data-old-price"),o=t.getAttribute("data-diff-price"),c=t.getAttribute("data-measure"),m=t.getAttribute("data-quantity"),h=BX.create("tr",{attrs:{"data-id":e,"data-img":s||"","data-url":i,"data-name":a,"data-print-price":r,"data-print-old-price":d,"data-price":n,"data-old-price":l,"data-diff-price":o,"data-measure":c,"data-quantity":m},children:[BX.create("td",{attrs:{className:"bx-added-item-table-cell-img"},children:[BX.create("img",{attrs:{src:s||this.noFotoSrc,className:"img-responsive"}})]}),BX.create("td",{attrs:{className:"bx-added-item-table-cell-itemname"},children:[BX.create("a",{attrs:{href:i,className:"tdn font_sm dark_link"},html:a})]}),BX.create("td",{attrs:{className:"bx-added-item-table-cell-price"},children:[BX.create("div",{attrs:{className:"bx-added-item-new-price font_sm"},html:r+" * "+m+c}),BX.create("div",{attrs:{className:"bx-added-item-old-price font_sxs muted"},html:n!=l?d:""})]}),BX.create("td",{attrs:{className:"bx-added-item-table-cell-del"},children:[BX.create("div",{attrs:{className:"bx-added-item-delete","data-role":"set-delete-btn"}})]})]}),this.setItemsCont.appendChild(h),this.numSliderItems--,this.numSetItems++,this.generateSliderStyles(),BX.remove(t),this.setIds.push(e),this.recountPrice(),0<this.numSetItems&&this.emptySetMessage&&BX.adjust(this.emptySetMessage,{style:{display:"none"},html:""}),this.numSliderItems<=0&&this.sliderParentCont&&(this.sliderParentCont.style.display="none"))},t.prototype.recountPrice=function(){var t,e,a,i=this.mainElementPrice*this.mainElementBasketQuantity,s=this.mainElementOldPrice*this.mainElementBasketQuantity,r=this.mainElementDiffPrice*this.mainElementBasketQuantity,n=BX.findChildren(this.setItemsCont,{tagName:"tr"},!0);if(n)for(t=0,e=n.length;t<e;t++)a=Number(n[t].getAttribute("data-quantity"))||1,i+=Number(n[t].getAttribute("data-price"))*a,s+=Number(n[t].getAttribute("data-old-price"))*a,r+=Number(n[t].getAttribute("data-diff-price"))*a;this.setPriceCont.innerHTML=BX.Currency.currencyFormat(i,this.currency,!0),this.setPriceDuplicateCont.innerHTML=BX.Currency.currencyFormat(i,this.currency,!0),0<Math.floor(100*r)?(this.setOldPriceCont.innerHTML=BX.Currency.currencyFormat(s,this.currency,!0),this.setDiffPriceCont.innerHTML=BX.Currency.currencyFormat(r,this.currency,!0),BX.style(this.setOldPriceRow,"display","table-row"),BX.style(this.setDiffPriceRow,"display","table-row")):(BX.style(this.setOldPriceRow,"display","none"),BX.style(this.setDiffPriceRow,"display","none"),this.setOldPriceCont.innerHTML="",this.setDiffPriceCont.innerHTML="")},t.prototype.addToBasket=function(){var t=BX.proxy_context;BX.showWait(t.parentNode),BX.ajax.post(this.ajaxPath,{sessid:BX.bitrix_sessid(),action:"catalogSetAdd2Basket",set_ids:this.setIds,lid:this.lid,iblockId:this.iblockId,setOffersCartProps:this.offersCartProps,itemsRatio:this.itemsRatio},BX.proxy(function(t){BX.closeWait(),document.location.href=this.basketUrl},this))},t}();