!function(){"use strict";BX.namespace("BX.Sale.BasketActionPool"),BX.Sale.BasketActionPool=function(component){this.component=component,this.requestProcessing=!1,this.updateTimer=null,this.isBasketRefreshed="Y"!==this.component.params.DEFERRED_REFRESH,this.needFullRecalculation="Y"===this.component.params.DEFERRED_REFRESH,this.pool={},this.lastActualPool={},this.approvedAction=["QUANTITY","DELETE","RESTORE","DELAY","OFFER","MERGE_OFFER"],this.switchTimer()},BX.Sale.BasketActionPool.prototype.setRefreshStatus=function(status){this.isBasketRefreshed=!!status},BX.Sale.BasketActionPool.prototype.getRefreshStatus=function(){return this.isBasketRefreshed},BX.Sale.BasketActionPool.prototype.isItemInPool=function(itemId){return!!this.pool[itemId]},BX.Sale.BasketActionPool.prototype.clearLastActualQuantityPool=function(itemId){this.lastActualPool[itemId]&&delete this.lastActualPool[itemId].QUANTITY},BX.Sale.BasketActionPool.prototype.checkItemPoolBefore=function(itemId){itemId&&(this.pool[itemId]=this.pool[itemId]||{})},BX.Sale.BasketActionPool.prototype.checkItemPoolAfter=function(itemId){itemId&&this.pool[itemId]&&0===Object.keys(this.pool[itemId]).length&&delete this.pool[itemId]},BX.Sale.BasketActionPool.prototype.addCoupon=function(coupon){this.pool.COUPON=coupon,this.switchTimer()},BX.Sale.BasketActionPool.prototype.removeCoupon=function(coupon){this.checkItemPoolBefore("REMOVE_COUPON"),this.pool.REMOVE_COUPON[coupon]=coupon,this.switchTimer()},BX.Sale.BasketActionPool.prototype.changeQuantity=function(itemId,quantity,oldQuantity){this.checkItemPoolBefore(itemId),this.lastActualPool[itemId]&&this.lastActualPool[itemId].QUANTITY!==quantity||!this.lastActualPool[itemId]&&quantity!==oldQuantity?this.pool[itemId].QUANTITY=quantity:this.pool[itemId]&&delete this.pool[itemId].QUANTITY,this.checkItemPoolAfter(itemId),this.switchTimer()},BX.Sale.BasketActionPool.prototype.deleteItem=function(itemId){this.checkItemPoolBefore(itemId),this.pool[itemId].RESTORE?delete this.pool[itemId].RESTORE:this.pool[itemId].DELETE="Y",this.checkItemPoolAfter(itemId),this.switchTimer()},BX.Sale.BasketActionPool.prototype.restoreItem=function(itemId,itemData){this.checkItemPoolBefore(itemId),"Y"===this.pool[itemId].DELETE?delete this.pool[itemId].DELETE:this.pool[itemId].RESTORE=itemData,this.checkItemPoolAfter(itemId),this.switchTimer()},BX.Sale.BasketActionPool.prototype.addDelayed=function(itemId){this.checkItemPoolBefore(itemId),this.pool[itemId].DELAY="Y",this.checkItemPoolAfter(itemId),this.switchTimer()},BX.Sale.BasketActionPool.prototype.removeDelayed=function(itemId){this.checkItemPoolBefore(itemId),this.pool[itemId].DELAY="N",this.clickByAllItemsTab=!0,this.checkItemPoolAfter(itemId),this.switchTimer()},BX.Sale.BasketActionPool.prototype.changeSku=function(itemId,props,oldProps){JSON.stringify(props)!==JSON.stringify(oldProps)?(this.checkItemPoolBefore(itemId),this.pool[itemId].OFFER=props):(this.pool[itemId]&&delete this.pool[itemId].OFFER,this.checkItemPoolAfter(itemId)),this.switchTimer()},BX.Sale.BasketActionPool.prototype.mergeSku=function(itemId){this.checkItemPoolBefore(itemId),this.pool[itemId].MERGE_OFFER="Y",this.switchTimer()},BX.Sale.BasketActionPool.prototype.switchTimer=function(){clearTimeout(this.updateTimer),this.isProcessing()||(this.isPoolEmpty()&&(this.component.editPostponedBasketItems(),this.component.fireCustomEvents()),this.isPoolEmpty()?this.getRefreshStatus()||this.trySendPool():this.updateTimer=setTimeout(BX.proxy(this.trySendPool,this),300))},BX.Sale.BasketActionPool.prototype.trySendPool=function(){this.isPoolEmpty()&&this.getRefreshStatus()||(this.doProcessing(!0),this.isPoolEmpty()?this.getRefreshStatus()||(this.component.sendRequest("refreshAjax",{fullRecalculation:this.needFullRecalculation?"Y":"N"}),this.needFullRecalculation=!1):(this.component.sendRequest("recalculateAjax",{clickByAllItemsTab:this.clickByAllItemsTab,basket:this.getPoolData()}),this.lastActualPool=this.pool,this.pool={}))},BX.Sale.BasketActionPool.prototype.getPoolData=function(){var poolData={},currentPool=this.pool;for(var id in currentPool.COUPON&&(poolData.coupon=currentPool.COUPON,delete currentPool.COUPON),currentPool.REMOVE_COUPON&&(poolData.delete_coupon=currentPool.REMOVE_COUPON,delete currentPool.REMOVE_COUPON),currentPool)if(currentPool.hasOwnProperty(id))for(var action in currentPool[id])currentPool[id].hasOwnProperty(action)&&BX.util.in_array(action,this.approvedAction)&&(poolData[action+"_"+id]=currentPool[id][action]);return poolData},BX.Sale.BasketActionPool.prototype.isPoolEmpty=function(){return 0===Object.keys(this.pool).length},BX.Sale.BasketActionPool.prototype.doProcessing=function(state){this.requestProcessing=!0===state,this.requestProcessing?this.component.startLoader():this.component.endLoader()},BX.Sale.BasketActionPool.prototype.isProcessing=function(){return!0===this.requestProcessing}}();
//# sourceMappingURL=action-pool.min.js.map