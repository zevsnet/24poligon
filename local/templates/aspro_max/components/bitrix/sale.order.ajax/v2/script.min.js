BX.saleOrderAjax={BXCallAllowed:!1,options:{},indexCache:{},controls:{},modes:{},properties:{},init:function(options){var ctx=this;this.options=options,window.submitFormProxy=BX.proxy((function(){ctx.submitFormProxy.apply(ctx,arguments)}),this),BX((function(){ctx.initDeferredControl()})),BX((function(){ctx.BXCallAllowed=!0})),this.controls.scope=BX("bx-soa-order-main"),BX.bindDelegate(this.controls.scope,"click",{className:"-bx-popup-set-mode-add-loc"},(function(){var input=BX.create("input",{attrs:{type:"hidden",name:"PERMANENT_MODE_STEPS",value:"1"}});BX.prepend(input,BX("bx-soa-order-main")),ctx.BXCallAllowed=!1,BX.Sale.OrderAjaxComponent.sendRequest()}))},cleanUp:function(){for(var k in this.properties)this.properties.hasOwnProperty(k)&&(void 0!==this.properties[k].input&&(BX.unbindAll(this.properties[k].input),this.properties[k].input=null),void 0!==this.properties[k].control&&BX.unbindAll(this.properties[k].control));this.properties={}},addPropertyDesc:function(desc){this.properties[desc.id]=desc.attributes,this.properties[desc.id].id=desc.id},initDeferredControl:function(){var ctx=this,k,row,input,locPropId,m,control,code,townInputFlag,adapter;if(void 0!==window.BX.locationsDeferred)for(k in this.BXCallAllowed=!1,window.BX.locationsDeferred)window.BX.locationsDeferred[k].call(this),window.BX.locationsDeferred[k]=null,delete window.BX.locationsDeferred[k],this.properties[k].control=window.BX.locationSelectors[k],delete window.BX.locationSelectors[k];for(k in this.properties){if(this.properties[k].isZip&&(row=this.controls.scope&&this.controls.scope.querySelector('[data-property-id-row="'+k+'"]'),BX.type.isElementNode(row)&&(input=row.querySelector('input[type="text"]'),BX.type.isElementNode(input)))){for(m in this.properties[k].input=input,locPropId=!1,this.properties)if("LOCATION"==this.properties[m].type){locPropId=m;break}!1!==locPropId&&BX.bindDebouncedChange(input,(function(value){var zipChangedNode=BX("ZIP_PROPERTY_CHANGED");zipChangedNode&&(zipChangedNode.value="Y"),input=null,row=null,BX.type.isNotEmptyString(value)&&/^\s*\d+\s*$/.test(value)&&value.length>3&&ctx.getLocationsByZip(value,(function(locationsData){ctx.properties[locPropId].control.setValueByLocationIds(locationsData)}),(function(){}))}))}"LOCATION"==this.properties[k].type&&void 0!==this.properties[k].control&&(code=(control=this.properties[k].control).getSysCode(),void 0!==this.properties[k].altLocationPropId&&("sls"==code&&control.replaceTemplate("nothing-found",this.options.messages.notFoundPrompt),"slst"==code&&function(k,control){control.setOption("pseudoValues",["other"]),control.bindEvent("control-before-display-page",(function(adapter){control=null;var parentValue=adapter.getParentValue();if(parentValue!=this.getOption("rootNodeValue")&&this.checkCanSelectItem(parentValue)){var controlInApater=adapter.getControl();void 0===controlInApater.vars.cache.nodes.other&&controlInApater.fillCache([{CODE:"other",DISPLAY:ctx.options.messages.otherLocation,IS_PARENT:!1,VALUE:"other"}],{modifyOrigin:!0,modifyOriginPosition:"prepend"})}})),townInputFlag=BX("LOCATION_ALT_PROP_DISPLAY_MANUAL["+parseInt(k)+"]"),control.bindEvent("after-select-real-value",(function(){BX.type.isDomNode(townInputFlag)&&(townInputFlag.value="0")})),control.bindEvent("after-select-pseudo-value",(function(){BX.type.isDomNode(townInputFlag)&&(townInputFlag.value="1")})),control.bindEvent("before-set-value",(function(){BX.type.isDomNode(townInputFlag)&&(townInputFlag.value="0")})),BX.type.isDomNode(townInputFlag)&&"1"==townInputFlag.value&&null!=(adapter=control.getAdapterAtPosition(control.getStackSize()-1))&&adapter.setValuePair("other",ctx.options.messages.otherLocation)}(k,control)))}this.BXCallAllowed=!0,BX.Sale.OrderAjaxComponent&&BX.Sale.OrderAjaxComponent.locationsCompletion()},checkMode:function(propId,mode){if("altLocationChoosen"==mode&&this.checkAbility(propId,"canHaveAltLocation")){var input=this.getInputByPropId(this.properties[propId].altLocationPropId),altPropId=this.properties[propId].altLocationPropId;if(!1!==input&&input.value.length>0&&!input.disabled&&"default"!=this.properties[altPropId].valueSource)return!0}return!1},checkAbility:function(propId,ability){if(void 0===this.properties[propId]&&(this.properties[propId]={}),void 0===this.properties[propId].abilities&&(this.properties[propId].abilities={}),void 0!==this.properties[propId].abilities&&this.properties[propId].abilities[ability])return!0;if("canHaveAltLocation"==ability&&"LOCATION"==this.properties[propId].type&&void 0!==this.properties[propId].altLocationPropId&&(this.properties[this.properties[propId].altLocationPropId],1)){var altLocPropId=this.properties[propId].altLocationPropId;if(void 0!==this.properties[propId].control&&"slst"==this.properties[propId].control.getSysCode()&&!1!==this.getInputByPropId(altLocPropId))return this.properties[propId].abilities[ability]=!0,!0}return!1},getInputByPropId:function(propId){if(void 0!==this.properties[propId].input)return this.properties[propId].input;var row=this.getRowByPropId(propId);if(BX.type.isElementNode(row)){var input=row.querySelector('input[type="text"]');if(BX.type.isElementNode(input))return this.properties[propId].input=input,input}return!1},getRowByPropId:function(propId){if(void 0!==this.properties[propId].row)return this.properties[propId].row;var row=this.controls.scope.querySelector('[data-property-id-row="'+propId+'"]');return!!BX.type.isElementNode(row)&&(this.properties[propId].row=row,row)},getAltLocPropByRealLocProp:function(propId){return void 0!==this.properties[propId].altLocationPropId&&this.properties[this.properties[propId].altLocationPropId]},toggleProperty:function(propId,way,dontModifyRow){var prop=this.properties[propId];void 0===prop.row&&(prop.row=this.getRowByPropId(propId)),void 0===prop.input&&(prop.input=this.getInputByPropId(propId)),way?(dontModifyRow||BX.show(prop.row),prop.input.disabled=!1):(dontModifyRow||BX.hide(prop.row),prop.input.disabled=!0)},submitFormProxy:function(item,control){var propId=!1;for(var k in this.properties)if(void 0!==this.properties[k].control&&this.properties[k].control==control){propId=k;break}"other"!=item&&this.BXCallAllowed&&(this.BXCallAllowed=!1,setTimeout((function(){BX.Sale.OrderAjaxComponent.sendRequest()}),20))},getPreviousAdapterSelectedNode:function(control,adapter){var index=adapter.getIndex(),prevAdapter=control.getAdapterAtPosition(index-1);if(void 0!==prevAdapter&&null!=prevAdapter){var prevValue=prevAdapter.getControl().getValue();if(void 0!==prevValue){var node=control.getNodeByValue(prevValue);return void 0!==node&&node}}return!1},getLocationsByZip:function(value,successCallback,notFoundCallback){if(void 0===this.indexCache[value]){var ctx=this;BX.ajax({url:this.options.source,method:"post",dataType:"json",async:!0,processData:!0,emulateOnload:!0,start:!0,data:{ACT:"GET_LOCS_BY_ZIP",ZIP:value},onsuccess:function(result){result.result?(ctx.indexCache[value]=result.data,successCallback.apply(ctx,[result.data])):notFoundCallback.call(ctx)},onfailure:function(type,e){}})}else successCallback.apply(this,[this.indexCache[value]])}};
//# sourceMappingURL=script.min.js.map