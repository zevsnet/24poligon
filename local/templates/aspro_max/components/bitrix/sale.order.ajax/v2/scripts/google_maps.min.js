BX.namespace("BX.Sale.OrderAjaxComponent.Maps"),function(){"use strict";BX.Sale.OrderAjaxComponent.Maps={init:function(ctx){return this.context=ctx||{},this.pickUpOptions=this.context.options.pickUpMap,this.propsOptions=this.context.options.propertyMap,this.maxWaitTimeExpired=!1,this.scheme=this.context.isHttps?"https":"http",this.icons={red:this.scheme+"://maps.google.com/mapfiles/ms/icons/red-dot.png",green:this.scheme+"://maps.google.com/mapfiles/ms/icons/green-dot.png"},this},initializePickUpMap:function(selected){if(google){this.markers=[],this.bounds=new google.maps.LatLngBounds;var lat=selected?parseFloat(BX.util.trim(selected.GPS_N)):this.pickUpOptions.defaultMapPosition.lat,lng=selected?parseFloat(BX.util.trim(selected.GPS_S)):this.pickUpOptions.defaultMapPosition.lon;this.pickUpMap=new google.maps.Map(BX("pickUpMap"),{center:{lat:lat,lng:lng},zoom:this.pickUpOptions.defaultMapPosition.zoom,scrollwheel:!1}),google.maps.event.addListener(this.pickUpMap,"click",BX.proxy(this.closeAllBalloons,this))}},canUseRecommendList:function(){return!1},getRecommendedStoreIds:function(geoLocation,length){return[]},getDistance:function(from,to){return!1},pickUpMapFocusWaiter:function(){this.pickUpMap&&this.markers.length?this.setPickUpMapFocus():setTimeout(BX.proxy(this.pickUpMapFocusWaiter,this),100)},setPickUpMapFocus:function(){google.maps.event.trigger(this.pickUpMap,"resize"),this.pickUpMap.fitBounds(this.bounds)},showNearestPickups:function(successCb,failCb){successCb(!1)},buildBalloons:function(activeStores){if(google){var i,marker,that=this;for(i=0;i<activeStores.length;i++)(marker=new google.maps.Marker({position:{lat:parseFloat(activeStores[i].GPS_N),lng:parseFloat(activeStores[i].GPS_S)},map:this.pickUpMap,title:activeStores[i].TITLE})).info=new google.maps.InfoWindow({content:"<h3>"+BX.util.htmlspecialchars(activeStores[i].TITLE)+"</h3>"+this.getStoreInfoHtml(activeStores[i])+'<br /><a class="btn btn-sm btn-default" data-store="'+activeStores[i].ID+'">'+this.context.params.MESS_SELECT_PICKUP+"</a>"}),marker.storeId=activeStores[i].ID,google.maps.event.addListener(marker.info,"domready",(function(){var button=document.querySelector("a[data-store]");button&&BX.bind(button,"click",BX.proxy(that.selectStoreByClick,that))})),google.maps.event.addListener(marker,"click",(function(){that.closeAllBalloons(),this.info.open(this.getMap(),this)})),BX("BUYER_STORE").value===activeStores[i].ID?marker.setIcon(this.icons.green):marker.setIcon(this.icons.red),this.markers.push(marker),this.bounds.extend(marker.getPosition())}},selectStoreByClick:function(e){var target=e.target||e.srcElement;this.context.selectStore(target.getAttribute("data-store")),this.closeAllBalloons()},closeAllBalloons:function(){for(var i=0;i<this.markers.length;i++)this.markers[i].info.close()},selectBalloon:function(storeItemId){if(this.pickUpMap&&this.markers&&this.markers.length)for(var i=0;i<this.markers.length;i++)this.markers[i].storeId===storeItemId?(this.markers[i].setIcon(this.icons.green),this.pickUpMap.panTo(this.markers[i].getPosition())):this.markers[i].setIcon(this.icons.red)},pickUpFinalAction:function(){},initializePropsMap:function(propsMapData){google&&(this.propsMap=new google.maps.Map(BX("propsMap"),{center:{lat:propsMapData.lat,lng:propsMapData.lon},zoom:propsMapData.zoom,scrollwheel:!1}),this.currentPropsMapCenter=this.propsMap.getCenter(),google.maps.event.addListener(this.propsMap,"click",BX.delegate((function(e){this.propsMarker?this.propsMarker.setPosition(e.latLng):(this.propsMarker=new google.maps.Marker({position:e.latLng,map:this.propsMap,draggable:!0}),this.propsMarker.addListener("drag",BX.proxy(this.onPropsMarkerChanged,this)),this.propsMarker.addListener("dragend",BX.proxy(this.onPropsMarkerChanged,this))),this.currentPropsMapCenter=e.latLng,this.onPropsMarkerChanged({latLng:e.latLng})}),this)))},onPropsMarkerChanged:function(event){var orderDesc=BX("orderDescription",!0),lat=event.latLng.lat(),lng=event.latLng.lng(),ind,before,after,string;orderDesc&&(-1===(ind=orderDesc.value.indexOf(BX.message("SOA_MAP_COORDS")+":"))?orderDesc.value=BX.message("SOA_MAP_COORDS")+": "+lat+", "+lng+"\r\n"+orderDesc.value:(string=BX.message("SOA_MAP_COORDS")+": "+lat+", "+lng,before=orderDesc.value.substring(0,ind),after=orderDesc.value.substring(ind+string.length),orderDesc.value=before+string+after))},propsMapFocusWaiter:function(){this.propsMap?this.setPropsMapFocus():setTimeout(BX.proxy(this.propsMapFocusWaiter,this),100)},setPropsMapFocus:function(){google.maps.event.trigger(this.propsMap,"resize"),this.propsMap.setCenter(this.currentPropsMapCenter)},getStoreInfoHtml:function(currentStore){var html="";return currentStore.ADDRESS&&(html+=BX.message("SOA_PICKUP_ADDRESS")+": "+BX.util.htmlspecialchars(currentStore.ADDRESS)+"<br />"),currentStore.PHONE&&(html+=BX.message("SOA_PICKUP_PHONE")+": "+BX.util.htmlspecialchars(currentStore.PHONE)+"<br />"),currentStore.SCHEDULE&&(html+=BX.message("SOA_PICKUP_WORK")+": "+BX.util.htmlspecialchars(currentStore.SCHEDULE)+"<br />"),currentStore.DESCRIPTION&&(html+=BX.message("SOA_PICKUP_DESC")+": "+BX.util.htmlspecialchars(currentStore.DESCRIPTION)+"<br />"),html}}}();
//# sourceMappingURL=google_maps.min.js.map