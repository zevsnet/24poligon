$.fn.phoneOrLogin=function(e){function s(e,a){var o,n=$(e),l=n.closest(".phone_or_login"),s=n.val(),i=n.data("code"),r=function(e){var a=e.replace(/[\s-_()]/g,""),o=e.replace(/[\s()]/g,""),n=!1,l=!1;return a.length&&((n=!!a.match(/^\+?\d*$/))||(l=-1!==o.indexOf("@"))),{value:e,clearPhone:a,bPossiblePhone:n,clearLogin:o,bPossibleEmail:l}}(s);if(s.length)if(r.bPossiblePhone){if(l.hasClass("phone_or_login-phone")){if(arMaxOptions.THEME.PHONE_MASK.length&&i.length&&(o=arMaxOptions.THEME.PHONE_MASK.replace(/\\9/,"#").replace(/[^0-8+#]/g,"").replace(/#/,"9")).length){for(t="[+?]",p=i+n.inputmask("unmaskedvalue"),h="",m=0;m<p.length;++m){if("+"!==(c=p.charAt(m))||m){g=t+("8"!==c||m&&(1!=m||"+"!==h)?c:"[78]"),_=new RegExp("^"+g);if(!o.match(_))break;t=g,h+=c}else h+=c}if(n.data("code",h),i!=h){n.val(p);E=arMaxOptions.THEME.PHONE_MASK.replace(/\\9/,"#").replace(/9/g,"*").replace(/#/,"\\9");n.inputmask("mask",{mask:E})}}}else if(n.removeClass("email").addClass("phone"),l.removeClass("phone_or_login-login").removeClass("phone_or_login-email").addClass("phone_or_login-phone"),arMaxOptions.THEME.PHONE_MASK.length)if((o=arMaxOptions.THEME.PHONE_MASK.replace(/\\9/,"#").replace(/[^0-8+#]/g,"").replace(/#/,"9")).length){for(var t="[+?]",p=s,h="",m=0;m<p.length;++m){var c;if("+"!==(c=p.charAt(m))||m){var g=t+("8"!==c||m&&(1!=m||"+"!==h)?c:"[78]"),_=new RegExp("^"+g);if(!o.match(_))break;t=g,h+=c}else h+=c}n.data("code",h),o.match(new RegExp("^"+t+"$"))&&n.val(p.substr(h.length));var E=arMaxOptions.THEME.PHONE_MASK.replace(/\\9/,"#").replace(/9/g,"*").replace(/#/,"\\9");n.inputmask("mask",{mask:E})}else{var E=arMaxOptions.THEME.PHONE_MASK.replace(/\\9/,"#").replace(/9/g,"*").replace(/#/,"\\9");n.inputmask("mask",{mask:E})}}else r.bPossibleEmail?l.hasClass("phone_or_login-email")||(n.removeClass("phone").addClass("email"),l.removeClass("phone_or_login-phone").removeClass("phone_or_login-login").addClass("phone_or_login-email"),arMaxOptions.THEME.PHONE_MASK.length&&(n.inputmask("mask",{mask:""}),$(e).val(i+$(e).val()))):l.hasClass("phone_or_login-login")||(n.removeClass("phone").removeClass("email"),l.removeClass("phone_or_login-phone").removeClass("phone_or_login-email").addClass("phone_or_login-login"),arMaxOptions.THEME.PHONE_MASK.length&&(n.inputmask("mask",{mask:""}),$(e).val(i+$(e).val())));else(l.hasClass("phone_or_login-login")||l.hasClass("phone_or_login-email")||l.hasClass("phone_or_login-phone"))&&(l.removeClass("phone_or_login-phone").removeClass("phone_or_login-login").removeClass("phone_or_login-email"),n.removeClass("phone").removeClass("email"),n.inputmask("mask",{mask:""}),n.data("code",""));"function"==typeof a&&a(e,r)}$(this).length&&$(this).each(function(){!function(e,o){var n=$(e),l=!1;void 0===n.data("phonecode")&&(n.data({phonecode:""}),n.data("code",""),n.bind({keydown:function(e){if(255!=e.which){var a=this;l&&clearTimeout(l),l=setTimeout(function(){s(a,o)},50)}},blur:function(e){var a=!n.val().length;arMaxOptions.THEME.PHONE_MASK.length&&(a|=arMaxOptions.THEME.PHONE_MASK.replace(/9/g,"_")==n.val());a&&(n.hasClass("required")&&n.parent().find("label.error").html(BX.message("JS_REQUIRED")),n.inputmask("mask",{mask:""}),n.data("code","")),s(this,o)},paste:function(e){var a=this;l&&clearTimeout(l),l=setTimeout(function(){s(a,o)},50)},cut:function(e){var a=this;l&&clearTimeout(l),l=setTimeout(function(){s(a,o)},50)}}),s(e,o))}(this,e)})};