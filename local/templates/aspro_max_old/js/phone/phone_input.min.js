window.appAspro=window.appAspro||{},window.appAspro.phone||(window.appAspro.phone={get checkIntlPhone(){return"function"==typeof window.intlTelInput},get checkInputmask(){return"function"==typeof window.Inputmask},get checkIntlTelInputUtils(){return"function"==typeof window.intlTelInputUtils},errorMap:["INVALID_NUMBER","INVALID_COUNTRY_CODE","TOO_SHORT","TOO_LONG","INVALID_NUMBER","INVALID_NUMBER"],get config(){return this._config||""},set config(config){this._config=config},init:function(els,options){const self=this,defaultOptions={useValidate:!0};!options&&this.config&&(options=this.config),options=$.extend({},defaultOptions,options||{}),this.checkIntlPhone?(options.coutriesData&&("undefined"==typeof allCountries?$.ajax({url:options.coutriesData,async:!1,success:function(data){allCountries&&(options.countries=allCountries)}}):options.countries=allCountries),this.initIntlPhone(els,options)):this.checkInputmask&&options.mask&&this.initNormalPhone(els,options)},initIntlPhone:function(els,options){let defaultOptions={utilsScript:arAsproOptions.SITE_TEMPLATE_PATH+"/vendor/js/intl.phone/utils.js",preferredCountries:["ru"],autoPlaceholder:"aggressive",nationalMode:!1,onlyCountries:["ru"],formatOnDisplay:!0,autoHideDialCode:!0};options=options||{};const pluginOptions=$.extend({},defaultOptions,options);pluginOptions.onlyCountries.length&&"string"==typeof pluginOptions.onlyCountries&&(pluginOptions.onlyCountries=pluginOptions.onlyCountries.split(",")),pluginOptions.preferredCountries.length&&"string"==typeof pluginOptions.preferredCountries&&(pluginOptions.preferredCountries=pluginOptions.preferredCountries.split(","));const self=this;els.each((function(i,node){let iti=window.intlTelInput(node,pluginOptions),_this=$(node);_this.data("iti",iti),_this.on("change",(function(){const inputVal=_this.val();if(!~inputVal.indexOf("+")&&inputVal.length&&_this.val("+"+inputVal),"undefined"!=typeof intlTelInputUtils){var currentText=iti.getNumber(intlTelInputUtils.numberFormat.E164);"string"==typeof currentText&&iti.setNumber(currentText)}iti.getSelectedCountryData().name||(_this.val(_this.val().replace("+8","+7")),iti.setNumber(_this.val()))})),_this.on("input",(function(e){const _this=$(this),telInput=_this.data("iti");let inputVal=_this.val();if(inputVal.length>=1&&!inputVal.includes("+")&&(_this.val("+"+inputVal),inputVal=_this.val()),inputVal.length>3&&(telInput.getSelectedCountryData().name||_this.val(inputVal.replace("+8","+7"))),"undefined"!=typeof intlTelInputUtils){var currentText=iti.getNumber(intlTelInputUtils.numberFormat.E164);"string"==typeof currentText&&iti.setNumber(currentText)}})),_this.on("keypress",(function(e){let key=String.fromCharCode(e.charCode?e.charCode:e.which);return""===e.target.value&&(e.target.value="+"),/\d/.test(key)})),_this.trigger("change")})),this.bindPhoneMask(els),options.useValidate&&this.addValidationIntlPhone()},initNormalPhone:function(els,options){let base_mask=options.mask.replace(/(\d)/g,"_");els.inputmask("mask",{mask:options.mask}),els.blur((function(){$(this).val()!=base_mask&&""!=$(this).val()||$(this).hasClass("required")&&$(this).parent().find("label.error").html(BX.message("JS_REQUIRED"))})),options.useValidate&&this.addValidationPhone()},addValidationIntlPhone:function(){$.validator.addMethod("intl_phone",(function(value,element,param){const telInput=$(element).data("iti");let valid=telInput.isValidNumber();return element.classList.contains("required")||null!==element.getAttribute("required")?valid?element.classList.remove("error"):element.classList.add("error"):valid=!0,valid}),(function(param,element){const telInput=$(element).data("iti");return BX.message(param[telInput.getValidationError()])||BX.message(param[0])})),$.validator.addClassRules({phone:{intl_phone:this.errorMap},phone_input:{intl_phone:this.errorMap}})},addValidationPhone:function(){arAsproOptions.THEME.VALIDATE_PHONE_MASK&&$.validator.addClassRules({phone:{regexp:arAsproOptions.THEME.VALIDATE_PHONE_MASK},phone_input:{regexp:arAsproOptions.THEME.VALIDATE_PHONE_MASK}})},bindPhoneMask:function(els){let _this=this;els.each((function(i,node){this.addEventListener("countrychange",(function(e){e.stopImmediatePropagation();const _this=$(e.target);"object"==typeof e.detail&&e.detail&&"_selectListItem"===e.detail.type&&(_this.trigger("input"),_this.valid())}))}))}});
//# sourceMappingURL=phone_input.min.js.map