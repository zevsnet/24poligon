(function(n){n.fn.jqm=function(o){var t=n.extend({},n.jqm.params,o);return this.each(function(){var o=n(this),i=n(this).data("jqm");i||(i={ID:u++}),o.data("jqm",n.extend(t,i)).addClass("jqm-init"),t.trigger&&n(this).jqmAddTrigger(t.trigger)})},n.fn.jqmAddTrigger=function(t){return this.each(function(){s(n(this),"jqmShow",t)||o("jqmAddTrigger must be called on initialized modals")})},n.fn.jqmAddClose=function(t){return this.each(function(){s(n(this),"jqmHide",t)||o("jqmAddClose must be called on initialized modals")})},n.fn.jqmShow=function(o){return this.each(function(){!this._jqmShown&&t(n(this),o)})},n.fn.jqmHide=function(o){return this.each(function(){this._jqmShown&&i(n(this),o)})};var o=function(n){window.console&&window.console.error&&window.console.error(n)},t=function(o,t){var i=o.data("jqm"),e=(t=t||window.event,parseInt(o.css("z-index")));if(void 0===i.noOverlay||void 0!==i.noOverlay&&!i.noOverlay){isNaN(e)&&(window.lastJqmZindex?window.lastJqmZindex=e=window.lastJqmZindex+2:e=3e3),window.lastJqmZindex=e;var a=n("<div></div>").addClass(i.overlayClass).css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":e-1,opacity:i.overlay/100});o.css("z-index",e)}else{a=n("");o.css("z-index",2999)}if(h={w:o,c:i,o:a,t:t},i.ajax){var s=i.target||o,d=i.ajax;s="string"==typeof s?n(s,o):n(s),"@"==d.substr(0,1)&&(d=n(t).attr(d.substring(1))),s.html(i.ajaxText).load(d,function(){i.onLoad&&i.onLoad.call(this,h),r(h)})}else r(h)},i=function(n,o){var t=n.data("jqm"),i=(o=o||window.event,{w:n,c:t,o:n.data("jqmv"),t:o});d(i)},e=function(o){return!o.w[0]._jqmShown&&(o.c.overlay>0&&o.o.prependTo("#popup_iframe_wrapper"),o.w.show(),n.jqm.focusFunc(o.w),!0)},a=function(n){return n.w.hide()&&n.o&&n.o.remove(),!0},s=function(o,t,i){return!!o.data("jqm")&&n(i).each(function(){this[t]=this[t]||[],this[t].push(o)}).click(function(){var o=this;return n.each(this[t],function(n,i){i[t](o)}),!1})},r=function(o){var t=o.w,i=o.o,e=o.c;!1!==e.onShow(o)&&(t[0]._jqmShown=!0,e.modal?(!l[0]&&c("bind"),l.push(t)):t.jqmAddClose(i),e.closeClass&&t.jqmAddClose(n("."+e.closeClass,t)),e.toTop&&i&&t.before('<span id="jqmP'+e.ID+'"></span>').insertAfter(i),t.data("jqmv",i))},d=function(o){var t=o.w,i=o.o,e=o.c;!1!==e.onHide(o)&&(t[0]._jqmShown=!1,e.modal&&(l.pop(),!l[0]&&c("unbind")),e.toTop&&i&&n("#jqmP"+e.ID).after(t).remove())},c=function(o){n(document)[o]("keypress keydown mousedown",m)},m=function(o){var t=n(o.target).data("jqm")||n(o.target).parents(".jqm-init:first").data("jqm"),i=l[l.length-1].data("jqm");return!(!t||t.ID!=i.ID)||n.jqm.focusFunc(i)},u=0,l=[];n.jqm={params:{overlay:50,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:!1,target:!1,ajaxText:"",modal:!1,toTop:!1,onShow:e,onHide:a,onLoad:!1},focusFunc:function(o){return n(":input:visible:first",o).focus(),!1}}})(jQuery);